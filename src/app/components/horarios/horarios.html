<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Horario Académico</h1>
    <div class="flex items-center space-x-4">
      <!-- Selector de Periodo Académico -->
      <select 
        [(ngModel)]="periodoSeleccionado" 
        (change)="onPeriodoChange()"
        class="border rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <option [ngValue]="null" disabled>Seleccione un período</option>
        @for (periodo of periodosAcademicos; track periodo.id) {
          <option [ngValue]="periodo">
            {{ periodo.nombre }} 
            @if (periodo.activo) {
              <span>(Activo)</span>
            }
          </option>
        }
      </select>

      <!-- Selector de Aula (solo visible si hay período seleccionado) -->
      @if (periodoSeleccionado) {
        <select 
          [(ngModel)]="aulaSeleccionada" 
          (change)="onAulaChange()"
          class="border rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option [ngValue]="null" disabled>Seleccione un aula</option>
          @for (aula of aulas; track aula.id) {
            <option [ngValue]="aula">{{ aula.nombre }} ({{ aula.jornada }})</option>
          }
        </select>
      }
    </div>
  </div>

  @if (loading) {
    <div class="flex justify-center items-center h-64">
      <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
    </div>
  } @else {
    @if (!periodoSeleccionado) {
      <div class="text-center py-8 text-gray-500">
        Selecciona un período académico para comenzar.
      </div>
    } @else if (aulas.length === 0) {
      <div class="text-center py-8 text-gray-500">
        No hay aulas con horarios asignados para este período.
      </div>
    } @else if (!aulaSeleccionada) {
      <div class="text-center py-8 text-gray-500">
        Selecciona un aula para ver su horario.
      </div>
    } @else {
      <!-- Info del aula seleccionada -->
      <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
        <div class="flex justify-between items-center">
          <div>
            <h2 class="text-lg font-semibold text-blue-800">
              Aula: {{ aulaSeleccionada.nombre }} ({{ aulaSeleccionada.codigo }})
            </h2>
            <p class="text-sm text-blue-600">
              Jornada: {{ aulaSeleccionada.jornada | titlecase }} | 
              Capacidad: {{ aulaSeleccionada.capacidad }} | 
              Período: {{ periodoSeleccionado.nombre }}
            </p>
          </div>
        </div>
      </div>

      <!-- Tabla de horarios -->
      <div class="bg-white shadow overflow-hidden sm:rounded-lg border border-gray-200">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Horario</th>
                @for (dia of diasSemana; track dia) {
                  <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    {{ dia | titlecase }}
                  </th>
                }
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              @for (bloque of bloques; track bloque.id) {
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <div class="font-medium">Bloque {{ bloque.numero }}</div>
                    <div class="text-gray-500">{{ bloque.horaInicio }} - {{ bloque.horaFin }}</div>
                  </td>
                  @for (dia of diasSemana; track dia) {
                    <td 
                      class="px-2 py-4 whitespace-nowrap text-center cursor-pointer"
                      (click)="openModal(dia, bloque)"
                    >
                      @if (getHorario(dia, bloque.id)) {
                        <div class="mx-1 p-2 rounded border border-blue-200 bg-blue-50 hover:bg-blue-100 transition">
                          <div class="font-medium text-blue-800 text-sm">
                            {{ getHorario(dia, bloque.id)?.asignatura?.codigo }}
                          </div>
                          <div class="text-xs text-blue-600 truncate">
                            {{ getHorario(dia, bloque.id)?.asignatura?.nombre }}
                          </div>
                          <div class="text-xs text-gray-500 mt-1">
                            {{ getHorario(dia, bloque.id)?.docente?.identificacion | slice:0:5 }}...
                          </div>
                        </div>
                      } @else {
                        <div class="mx-1 p-3 rounded border-2 border-dashed border-gray-300 hover:border-blue-300 hover:bg-blue-50 transition">
                          <span class="text-gray-400 text-sm">Agregar</span>
                        </div>
                      }
                    </td>
                  }
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }
  }
<!-- Modal -->
@if (modalOpen && currentBloque && aulaSeleccionada && periodoSeleccionado) {
  <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; justify-content: center; align-items: center;">
    <div style="background: white; padding: 20px; border-radius: 8px; max-width: 80%; max-height: 80%; overflow: auto;">
      <app-horario-modal
        [dia]="currentDia"
        [bloque]="currentBloque"
        [aula]="aulaSeleccionada"
        [periodoSeleccionado]="periodoSeleccionado"
        [horario]="selectedHorario"
        (close)="closeModal()"
        (saved)="onHorarioSaved($event)">
      </app-horario-modal>
    </div>
  </div>
}